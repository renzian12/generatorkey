<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>X-FREE Key Manager</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            font-family: 'Poppins', sans-serif;
            background-color: #161616;
        }
        .press-effect:active {
            transform: scale(0.96);
            transition: transform 0.1s ease-in-out;
        }
        .glass-card {
            background: rgba(32, 32, 32, 0.9);
            backdrop-filter: blur(10px);
        }
        .key-item {
            transition: all 0.2s ease;
        }
        .key-item:hover {
            background: #2a2a2a;
            transform: translateY(-2px);
        }
    </style>
</head>
<body class="min-h-screen text-white bg-[#161616]">
    <!-- Header -->
    <nav class="flex justify-between items-center px-5 md:px-20 py-5 bg-[#202020] shadow-lg">
        <div class="flex items-center space-x-3">
            <img src="https://media.discordapp.net/attachments/1385041743111782490/1434508499454529646/New_Project.png?ex=691a61e6&is=69191066&hm=64ab6c01e70c0691a06df88c4665b6ceba1fef61fb1a0d78134f9616cf8a219e&=&format=webp&quality=lossless" alt="X-FREE Logo" class="w-8 h-8 rounded-lg">
            <span class="text-xl font-semibold">X-FREE Key Manager</span>
        </div>
        <div class="flex items-center space-x-2">
            <span class="status-indicator hidden" id="statusIndicator"></span>
            <span class="text-sm text-gray-400" id="statusText">Not Connected</span>
        </div>
    </nav>

    <!-- Alert -->
    <div id="alert" class="hidden fixed top-20 left-1/2 transform -translate-x-1/2 z-50 px-6 py-4 rounded-xl shadow-2xl max-w-md w-full mx-4"></div>

    <!-- Main Content -->
    <main class="container mx-auto px-4 py-8 max-w-6xl">
        
        <!-- GitHub Setup Section -->
        <div class="glass-card p-6 md:p-8 rounded-2xl shadow-lg mb-6" id="setupSection">
            <h2 class="text-2xl font-bold mb-4 flex items-center">
                <span class="text-3xl mr-3">‚öôÔ∏è</span>
                GitHub Configuration
            </h2>
            <p class="text-gray-400 mb-6">Configure once, generate keys forever!</p>
            
            <div class="space-y-4">
                <div>
                    <label class="block text-sm font-medium mb-2">GitHub Personal Access Token</label>
                    <input type="password" id="githubToken" placeholder="ghp_xxxxxxxxxxxxxxxxxxxx"
                           class="w-full px-4 py-3 bg-[#161616] rounded-xl border border-[#333] focus:outline-none focus:border-orange-500 transition">
                    <p class="text-xs text-gray-500 mt-1">Settings ‚Üí Developer settings ‚Üí Personal access tokens</p>
                </div>

                <div>
                    <label class="block text-sm font-medium mb-2">Repository (username/repo)</label>
                    <input type="text" id="githubRepo" placeholder="yourusername/xfree-keys"
                           class="w-full px-4 py-3 bg-[#161616] rounded-xl border border-[#333] focus:outline-none focus:border-orange-500 transition">
                </div>

                <div>
                    <label class="block text-sm font-medium mb-2">File Path</label>
                    <input type="text" id="githubFilePath" value="keys.txt"
                           class="w-full px-4 py-3 bg-[#161616] rounded-xl border border-[#333] focus:outline-none focus:border-orange-500 transition">
                </div>

                <div class="flex flex-wrap gap-3">
                    <button onclick="saveGitHubConfig()"
                            class="px-6 py-3 bg-gradient-to-r from-orange-500 to-pink-500 text-white font-semibold rounded-xl hover:brightness-110 transition press-effect">
                        üíæ Save Configuration
                    </button>
                    <button onclick="testGitHubConnection()"
                            class="px-6 py-3 bg-white text-black font-semibold rounded-xl hover:brightness-110 transition press-effect">
                        üîå Test Connection
                    </button>
                </div>
            </div>

            <!-- Setup Guide -->
            <div class="mt-6 p-4 bg-[#161616] rounded-xl border border-[#333]">
                <h3 class="font-semibold mb-3 text-orange-400">üìñ Quick Setup Guide</h3>
                <ol class="text-sm text-gray-300 space-y-2 list-decimal list-inside">
                    <li>Create a <strong>public</strong> GitHub repository (e.g., "xfree-keys")</li>
                    <li>Generate a Personal Access Token with <strong>repo</strong> scope</li>
                    <li>Fill in the form above and click "Save Configuration"</li>
                    <li>Test your connection - Done! üéâ</li>
                </ol>
            </div>
        </div>

        <!-- Stats -->
        <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6" id="statsSection" style="display: none;">
            <div class="glass-card p-6 rounded-2xl text-center">
                <div class="text-4xl font-bold bg-gradient-to-r from-orange-500 to-pink-500 bg-clip-text text-transparent" id="keyCount">0</div>
                <div class="text-gray-400 text-sm mt-2">Active Keys</div>
            </div>
            <div class="glass-card p-6 rounded-2xl text-center">
                <div class="text-4xl font-bold bg-gradient-to-r from-orange-500 to-pink-500 bg-clip-text text-transparent" id="totalGenerated">0</div>
                <div class="text-gray-400 text-sm mt-2">Total Generated</div>
            </div>
            <div class="glass-card p-6 rounded-2xl text-center">
                <div class="text-4xl font-bold" id="syncStatus">‚è≥</div>
                <div class="text-gray-400 text-sm mt-2">Last Sync</div>
            </div>
        </div>

        <!-- Generate Keys Section -->
        <div class="glass-card p-6 md:p-8 rounded-2xl shadow-lg mb-6" id="generateSection" style="display: none;">
            <h2 class="text-2xl font-bold mb-4 flex items-center">
                <span class="text-3xl mr-3">üéØ</span>
                Generate Keys
            </h2>
            
            <div class="mb-6 p-4 bg-[#161616] rounded-xl border border-[#333]">
                <h3 class="font-semibold mb-3 text-orange-400">Generate with Name (Optional)</h3>
                <div class="flex gap-3 flex-wrap">
                    <input type="text" id="keyName" placeholder="Key name (e.g., John's Key, VIP Access)"
                           class="flex-1 min-w-[200px] px-4 py-3 bg-[#202020] rounded-xl border border-[#333] focus:outline-none focus:border-orange-500 transition">
                    <input type="number" id="namedKeyAmount" placeholder="Amount" min="1" max="100" value="1"
                           class="w-24 px-4 py-3 bg-[#202020] rounded-xl border border-[#333] focus:outline-none focus:border-orange-500 transition">
                    <button onclick="generateNamedKeys()"
                            class="px-6 py-3 bg-gradient-to-r from-orange-500 to-pink-500 text-white font-semibold rounded-xl hover:brightness-110 transition press-effect">
                        üè∑Ô∏è Generate Named Key
                    </button>
                </div>
                <p class="text-xs text-gray-500 mt-2">Name your keys to easily identify who they belong to</p>
            </div>

            <h3 class="font-semibold mb-3">Quick Generate (Unnamed)</h3>
            <div class="flex flex-wrap gap-3 mb-4">
                <button onclick="generateKeys(1)" class="px-6 py-3 bg-white text-black font-semibold rounded-xl hover:brightness-110 transition press-effect">
                    Generate 1
                </button>
                <button onclick="generateKeys(5)" class="px-6 py-3 bg-white text-black font-semibold rounded-xl hover:brightness-110 transition press-effect">
                    Generate 5
                </button>
                <button onclick="generateKeys(10)" class="px-6 py-3 bg-white text-black font-semibold rounded-xl hover:brightness-110 transition press-effect">
                    Generate 10
                </button>
                <button onclick="generateKeys(25)" class="px-6 py-3 bg-white text-black font-semibold rounded-xl hover:brightness-110 transition press-effect">
                    Generate 25
                </button>
                <button onclick="generateKeys(50)" class="px-6 py-3 bg-white text-black font-semibold rounded-xl hover:brightness-110 transition press-effect">
                    Generate 50
                </button>
                <button onclick="generateKeys(100)" class="px-6 py-3 bg-white text-black font-semibold rounded-xl hover:brightness-110 transition press-effect">
                    Generate 100
                </button>
            </div>

            <div class="flex gap-3 items-center mb-4">
                <input type="number" id="customAmount" placeholder="Custom amount" min="1" max="10000" value="10"
                       class="px-4 py-3 bg-[#161616] rounded-xl border border-[#333] focus:outline-none focus:border-orange-500 transition w-40">
                <button onclick="generateCustom()"
                        class="px-6 py-3 bg-gradient-to-r from-orange-500 to-pink-500 text-white font-semibold rounded-xl hover:brightness-110 transition press-effect">
                    Generate Custom
                </button>
            </div>

            <button onclick="syncToGitHub()"
                    class="px-6 py-3 bg-gradient-to-r from-green-500 to-emerald-500 text-white font-semibold rounded-xl hover:brightness-110 transition press-effect">
                üîÑ Sync to GitHub Now
            </button>
        </div>

        <!-- Keys Display Section -->
        <div class="glass-card p-6 md:p-8 rounded-2xl shadow-lg mb-6" id="keysSection" style="display: none;">
            <h2 class="text-2xl font-bold mb-4 flex items-center justify-between">
                <span class="flex items-center">
                    <span class="text-3xl mr-3">üìã</span>
                    Active Keys (<span id="keyCount2">0</span>)
                </span>
            </h2>
            
            <div class="flex flex-wrap gap-3 mb-4">
                <button onclick="copyAllKeys()"
                        class="px-6 py-3 bg-white text-black font-semibold rounded-xl hover:brightness-110 transition press-effect">
                    üìã Copy All
                </button>
                <button onclick="exportKeys()"
                        class="px-6 py-3 bg-gradient-to-r from-blue-500 to-indigo-500 text-white font-semibold rounded-xl hover:brightness-110 transition press-effect">
                    üíæ Export
                </button>
                <button onclick="clearAllKeys()"
                        class="px-6 py-3 bg-gradient-to-r from-red-500 to-rose-500 text-white font-semibold rounded-xl hover:brightness-110 transition press-effect">
                    üóëÔ∏è Clear All
                </button>
            </div>

            <div id="keyList" class="space-y-2 max-h-96 overflow-y-auto">
                <div class="text-center py-12 text-gray-500">No keys generated yet</div>
            </div>
        </div>

        <!-- GitHub URL Section -->
        <div class="glass-card p-6 md:p-8 rounded-2xl shadow-lg" id="urlSection" style="display: none;">
            <h2 class="text-2xl font-bold mb-4 flex items-center">
                <span class="text-3xl mr-3">üîó</span>
                Your GitHub Raw URL
            </h2>
            <p class="text-gray-400 mb-4">Copy this URL and paste it into your Roblox script's <code class="text-orange-400">VALID_KEYS_URL</code></p>
            
            <div class="bg-[#161616] p-4 rounded-xl border border-[#333] mb-4">
                <code class="text-green-400 text-sm break-all" id="githubRawUrl">Configure GitHub first</code>
            </div>

            <button onclick="copyGitHubUrl()"
                    class="px-6 py-3 bg-gradient-to-r from-orange-500 to-pink-500 text-white font-semibold rounded-xl hover:brightness-110 transition press-effect">
                üìã Copy GitHub URL
            </button>

            <div class="mt-6 p-4 bg-gradient-to-r from-green-500/10 to-emerald-500/10 rounded-xl border border-green-500/20">
                <h3 class="font-semibold mb-2 text-green-400">‚úÖ You're All Set!</h3>
                <p class="text-sm text-gray-300">Every time you generate keys, they automatically sync to GitHub. Your Roblox script will fetch the latest keys automatically!</p>
            </div>
        </div>

    </main>

    <!-- Footer -->
    <footer class="bg-[#202020] text-center text-sm py-4 text-gray-400 mt-12">
        &copy; 2025 X-FREE Key Manager. All rights reserved.
    </footer>

    <script>
        let keys = new Set();
        let keyNames = {}; // Store key names: { "XFREE-XXXX": "John's Key" }
        let totalGenerated = 0;
        let config = {
            token: '',
            repo: '',
            filePath: 'keys.txt',
            sha: ''
        };

        function init() {
            loadConfig();
            loadKeys();
            updateDisplay();
            checkSetupComplete();
        }

        function loadConfig() {
            const saved = localStorage.getItem('github_config');
            if (saved) {
                config = JSON.parse(saved);
                document.getElementById('githubToken').value = config.token;
                document.getElementById('githubRepo').value = config.repo;
                document.getElementById('githubFilePath').value = config.filePath;
            }
        }

        function saveConfig() {
            localStorage.setItem('github_config', JSON.stringify(config));
        }

        function loadKeys() {
            const saved = localStorage.getItem('xfree_keys');
            const savedTotal = localStorage.getItem('xfree_total');
            const savedNames = localStorage.getItem('xfree_key_names');
            if (saved) {
                keys = new Set(JSON.parse(saved));
            }
            if (savedTotal) {
                totalGenerated = parseInt(savedTotal);
            }
            if (savedNames) {
                keyNames = JSON.parse(savedNames);
            }
        }

        function saveKeys() {
            localStorage.setItem('xfree_keys', JSON.stringify([...keys]));
            localStorage.setItem('xfree_total', totalGenerated.toString());
            localStorage.setItem('xfree_key_names', JSON.stringify(keyNames));
        }

        function saveGitHubConfig() {
            const token = document.getElementById('githubToken').value.trim();
            const repo = document.getElementById('githubRepo').value.trim();
            const filePath = document.getElementById('githubFilePath').value.trim();

            if (!token || !repo || !filePath) {
                showAlert('Please fill in all fields', 'error');
                return;
            }

            config.token = token;
            config.repo = repo;
            config.filePath = filePath;
            saveConfig();

            showAlert('Configuration saved! Click "Test Connection" to verify.', 'success');
            checkSetupComplete();
        }

        async function testGitHubConnection() {
            if (!config.token || !config.repo) {
                showAlert('Please save configuration first', 'error');
                return;
            }

            showAlert('Testing connection...', 'info');

            try {
                const response = await fetch(`https://api.github.com/repos/${config.repo}`, {
                    headers: {
                        'Authorization': `token ${config.token}`,
                        'Accept': 'application/vnd.github.v3+json'
                    }
                });

                if (response.ok) {
                    showAlert('‚úÖ Connection successful!', 'success');
                    document.getElementById('statusText').textContent = 'Connected';
                    document.getElementById('statusIndicator').className = 'status-indicator w-3 h-3 bg-green-500 rounded-full';
                    document.getElementById('statusIndicator').classList.remove('hidden');
                    checkSetupComplete();
                } else {
                    showAlert('‚ùå Connection failed. Check your token and repository name.', 'error');
                }
            } catch (error) {
                showAlert('‚ùå Connection error: ' + error.message, 'error');
            }
        }

        function checkSetupComplete() {
            if (config.token && config.repo && config.filePath) {
                document.getElementById('statsSection').style.display = 'grid';
                document.getElementById('generateSection').style.display = 'block';
                document.getElementById('keysSection').style.display = 'block';
                document.getElementById('urlSection').style.display = 'block';
                updateGitHubUrl();
            }
        }

        function updateGitHubUrl() {
            const url = `https://raw.githubusercontent.com/${config.repo}/main/${config.filePath}`;
            document.getElementById('githubRawUrl').textContent = url;
        }

        function copyGitHubUrl() {
            const url = `https://raw.githubusercontent.com/${config.repo}/main/${config.filePath}`;
            navigator.clipboard.writeText(url).then(() => {
                showAlert('GitHub URL copied! Paste it into your Roblox script.', 'success');
            });
        }

        function generateRandomKey() {
            const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789';
            const segments = [];
            for (let i = 0; i < 4; i++) {
                let segment = '';
                for (let j = 0; j < 4; j++) {
                    segment += chars[Math.floor(Math.random() * chars.length)];
                }
                segments.push(segment);
            }
            return 'XFREE-' + segments.join('-');
        }

        async function generateNamedKeys() {
            const name = document.getElementById('keyName').value.trim();
            const amount = parseInt(document.getElementById('namedKeyAmount').value);

            if (!name) {
                showAlert('Please enter a name for the key', 'error');
                return;
            }

            if (isNaN(amount) || amount < 1 || amount > 100) {
                showAlert('Please enter a valid amount (1-100)', 'error');
                return;
            }

            const startSize = keys.size;
            const generatedKeys = [];

            for (let i = 0; i < amount; i++) {
                const key = generateRandomKey();
                keys.add(key);
                const fullName = amount > 1 ? `${name} #${i + 1}` : name;
                keyNames[key] = fullName;
                generatedKeys.push(key);
            }

            const newKeys = keys.size - startSize;
            totalGenerated += newKeys;
            saveKeys();
            updateDisplay();

            // Clear input
            document.getElementById('keyName').value = '';
            document.getElementById('namedKeyAmount').value = '1';

            showAlert(`Generated ${newKeys} key(s) named "${name}". Syncing to GitHub...`, 'info');
            await syncToGitHub();
        }

        async function generateKeys(count) {
            const startSize = keys.size;
            for (let i = 0; i < count; i++) {
                keys.add(generateRandomKey());
            }
            const newKeys = keys.size - startSize;
            totalGenerated += newKeys;
            saveKeys();
            updateDisplay();
            showAlert(`Generated ${newKeys} keys. Syncing to GitHub...`, 'info');
            await syncToGitHub();
        }

        async function generateCustom() {
            const count = parseInt(document.getElementById('customAmount').value);
            if (isNaN(count) || count < 1) {
                showAlert('Please enter a valid number', 'error');
                return;
            }
            await generateKeys(count);
        }

        async function syncToGitHub() {
            if (!config.token || !config.repo) {
                showAlert('Please configure GitHub first', 'error');
                return;
            }

            if (keys.size === 0) {
                showAlert('No keys to sync', 'error');
                return;
            }

            const content = [...keys].join('\n');
            const encodedContent = btoa(content);

            try {
                let fileExists = false;
                let currentSha = '';

                const getResponse = await fetch(`https://api.github.com/repos/${config.repo}/contents/${config.filePath}`, {
                    headers: {
                        'Authorization': `token ${config.token}`,
                        'Accept': 'application/vnd.github.v3+json'
                    }
                });

                if (getResponse.ok) {
                    const fileData = await getResponse.json();
                    currentSha = fileData.sha;
                    fileExists = true;
                }

                const body = {
                    message: `Update keys: ${keys.size} total keys`,
                    content: encodedContent,
                    branch: 'main'
                };

                if (fileExists) {
                    body.sha = currentSha;
                }

                const response = await fetch(`https://api.github.com/repos/${config.repo}/contents/${config.filePath}`, {
                    method: 'PUT',
                    headers: {
                        'Authorization': `token ${config.token}`,
                        'Accept': 'application/vnd.github.v3+json',
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(body)
                });

                if (response.ok) {
                    showAlert('‚úÖ Keys synced to GitHub successfully!', 'success');
                    document.getElementById('syncStatus').textContent = '‚úÖ';
                    updateGitHubUrl();
                } else {
                    const error = await response.json();
                    showAlert('‚ùå Sync failed: ' + (error.message || 'Unknown error'), 'error');
                }
            } catch (error) {
                showAlert('‚ùå Sync error: ' + error.message, 'error');
            }
        }

        function deleteKey(key) {
            keys.delete(key);
            delete keyNames[key]; // Remove the name too
            saveKeys();
            updateDisplay();
            showAlert('Key deleted. Remember to sync to GitHub!', 'success');
        }

        function editKeyName(key) {
            const currentName = keyNames[key] || '';
            const newName = prompt('Enter new name for this key:', currentName);
            if (newName !== null && newName.trim() !== '') {
                keyNames[key] = newName.trim();
                saveKeys();
                updateDisplay();
                showAlert('Key name updated!', 'success');
            }
        }

        function copyKey(key) {
            navigator.clipboard.writeText(key).then(() => {
                showAlert('Key copied!', 'success');
            });
        }

        function copyAllKeys() {
            if (keys.size === 0) {
                showAlert('No keys to copy', 'error');
                return;
            }
            navigator.clipboard.writeText([...keys].join('\n')).then(() => {
                showAlert(`Copied ${keys.size} keys!`, 'success');
            });
        }

        function exportKeys() {
            if (keys.size === 0) {
                showAlert('No keys to export', 'error');
                return;
            }
            const blob = new Blob([[...keys].join('\n')], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `xfree-keys-${new Date().toISOString().split('T')[0]}.txt`;
            a.click();
            showAlert('Keys exported!', 'success');
        }

        function clearAllKeys() {
            if (keys.size === 0) {
                showAlert('No keys to clear', 'error');
                return;
            }
            if (confirm(`Delete all ${keys.size} keys? This will also sync to GitHub.`)) {
                keys.clear();
                saveKeys();
                updateDisplay();
                syncToGitHub();
            }
        }

        function updateDisplay() {
            document.getElementById('keyCount').textContent = keys.size;
            document.getElementById('keyCount2').textContent = keys.size;
            document.getElementById('totalGenerated').textContent = totalGenerated;

            const keyList = document.getElementById('keyList');
            if (keys.size === 0) {
                keyList.innerHTML = '<div class="text-center py-12 text-gray-500">No keys generated yet</div>';
            } else {
                keyList.innerHTML = '';
                [...keys].forEach(key => {
                    const item = document.createElement('div');
                    item.className = 'key-item flex flex-col md:flex-row justify-between items-start md:items-center p-4 bg-[#161616] rounded-xl border border-[#333] gap-3';
                    
                    const keyName = keyNames[key];
                    const nameDisplay = keyName ? `<div class="text-orange-400 text-sm font-semibold mb-1">üè∑Ô∏è ${keyName}</div>` : '';
                    
                    item.innerHTML = `
                        <div class="flex-1">
                            ${nameDisplay}
                            <span class="font-mono text-sm text-gray-300">${key}</span>
                        </div>
                        <div class="flex gap-2 flex-wrap">
                            ${keyName ? `
                            <button onclick="editKeyName('${key}')" class="px-4 py-2 bg-blue-500 text-white font-semibold rounded-lg hover:brightness-110 transition press-effect text-sm">
                                ‚úèÔ∏è Edit Name
                            </button>
                            ` : `
                            <button onclick="editKeyName('${key}')" class="px-4 py-2 bg-gray-600 text-white font-semibold rounded-lg hover:brightness-110 transition press-effect text-sm">
                                üè∑Ô∏è Add Name
                            </button>
                            `}
                            <button onclick="copyKey('${key}')" class="px-4 py-2 bg-white text-black font-semibold rounded-lg hover:brightness-110 transition press-effect text-sm">
                                üìã Copy
                            </button>
                            <button onclick="deleteKey('${key}')" class="px-4 py-2 bg-red-500 text-white font-semibold rounded-lg hover:brightness-110 transition press-effect text-sm">
                                üóëÔ∏è
                            </button>
                        </div>
                    `;
                    keyList.appendChild(item);
                });
            }
        }

        function showAlert(message, type) {
            const alert = document.getElementById('alert');
            const colors = {
                success: 'bg-green-500',
                error: 'bg-red-500',
                info: 'bg-blue-500'
            };
            alert.className = `fixed top-20 left-1/2 transform -translate-x-1/2 z-50 px-6 py-4 rounded-xl shadow-2xl max-w-md w-full mx-4 ${colors[type]} text-white`;
            alert.textContent = message;
            alert.classList.remove('hidden');
            setTimeout(() => alert.classList.add('hidden'), 4000);
        }

        init();
    </script>
</body>
</html>
